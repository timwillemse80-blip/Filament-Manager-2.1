# Filament Manager

Manage your 3D printer filament stock simply and modernly.

## üöÄ Connecting with Supabase (Guide)

1.  Create a new project on [Supabase.com](https://supabase.com).
2.  Go to **Project Settings** > **API**.
3.  Copy the `Project URL` and the `anon public` key.
4.  Add these to Vercel (or your `.env` file) as:
    *   `VITE_SUPABASE_URL`
    *   `VITE_SUPABASE_ANON_KEY`
5.  In Supabase, go to the **SQL Editor** and paste the script below.

## üõ†Ô∏è Master Database Script (SQL)

Copy and execute this script in the Supabase SQL Editor to set up all tables and permissions correctly in one go.

```sql
-- 0. USER PROFILES
create table if not exists public.profiles (
  id uuid primary key references auth.users(id) on delete cascade,
  email text,
  is_pro boolean default false,
  showcase_name text,
  created_at timestamptz default now()
);
alter table public.profiles enable row level security;
drop policy if exists "Users can view own profile" on public.profiles;
create policy "Users can view own profile" on public.profiles for select using (auth.uid() = id);
drop policy if exists "Users can update own profile" on public.profiles;
create policy "Users can update own profile" on public.profiles for update using (auth.uid() = id);
drop policy if exists "Users can insert own profile" on public.profiles;
create policy "Users can insert own profile" on public.profiles for insert with check (auth.uid() = id);

-- 1. SPOOL DATABASE SCHEMA UPDATE (Handles existing databases too)
create table if not exists public.spool_weights (
  id bigint generated by default as identity primary key,
  weight numeric,
  name text
);

-- Add columns to existing table if they are missing
do $$ 
begin 
  if not exists (select 1 from information_schema.columns where table_name='spool_weights' and column_name='brand') then
    alter table public.spool_weights add column brand text;
  end if;
  if not exists (select 1 from information_schema.columns where table_name='spool_weights' and column_name='size') then
    alter table public.spool_weights add column size text;
  end if;
  if not exists (select 1 from information_schema.columns where table_name='spool_weights' and column_name='spool_material') then
    alter table public.spool_weights add column spool_material text;
  end if;
end $$;

alter table public.spool_weights enable row level security;
drop policy if exists "Public read access" on public.spool_weights;
create policy "Public read access" on public.spool_weights for select using (true);
drop policy if exists "Admins manage spools" on public.spool_weights;
create policy "Admins manage spools" on public.spool_weights for all using (true);

-- 2. OTHER TABLES
create table if not exists public.brands (id bigint generated by default as identity primary key, name text unique);
create table if not exists public.materials (id bigint generated by default as identity primary key, name text unique);
create table if not exists public.global_settings (key text primary key, value text);
create table if not exists public.feedback (id bigint generated by default as identity primary key, created_at timestamptz default now(), message text, rating int, user_id uuid, is_read boolean default false, platform text, user_agent text);

alter table public.brands enable row level security;
alter table public.materials enable row level security;
alter table public.global_settings enable row level security;
alter table public.feedback enable row level security;

-- Policies for Feedback
drop policy if exists "Everyone can send feedback" on public.feedback;
create policy "Everyone can send feedback" on public.feedback for insert with check (true);
drop policy if exists "Admins can view feedback" on public.feedback;
create policy "Admins can view feedback" on public.feedback for select using (true);

-- Policies for Global Data
drop policy if exists "Public read access brands" on public.brands;
create policy "Public read access brands" on public.brands for select using (true);
drop policy if exists "Public read access materials" on public.materials;
create policy "Public read access materials" on public.materials for select using (true);
drop policy if exists "Public read access global" on public.global_settings;
create policy "Public read access global" on public.global_settings for select using (true);

drop policy if exists "Admins manage all" on public.brands;
create policy "Admins manage all" on public.brands for all using (true);
drop policy if exists "Admins manage all mat" on public.materials;
create policy "Admins manage all mat" on public.materials for all using (true);
drop policy if exists "Admins manage all glob" on public.global_settings;
create policy "Admins manage all glob" on public.global_settings for all using (true);
```